#pragma once
#include <mutex>
#include <deque>

//====================================================================================
// Forward Declare
//====================================================================================


//====================================================================================
// Type Defs + Defines
//====================================================================================


//====================================================================================
// ENUMS
//====================================================================================


//====================================================================================
// Structs
//====================================================================================


//====================================================================================
// Classes
//====================================================================================
class SpinLock
{
public:
	SpinLock() {}

	void Enter() { m_lock.lock(); } // blocking operation
	bool TryToEnter() { return m_lock.try_lock(); }
	void Leave() { m_lock.unlock(); } // must be called if entered

public: 
	std::mutex m_lock; 
};



//====================================================================================
template <typename T>
class ThreadSafeQueue
{
public:
	void enqueue( T const &v )
	{
		m_lock.Enter();

		// I AM THE ONLY PERSON HERE
		m_data.push_back( v ); 

		m_lock.Leave();
		// no longer true...
	}


	// return if it succeeds
	bool dequeue( T *out_v ) 
	{
		m_lock.Enter();

		bool has_item = !m_data.empty();
		if (has_item) 
		{
			*out_v = m_data.front();
			
			//delete m_data.front(); // shouldnt be an issue
			m_data.pop_front(); 
		}

		m_lock.Leave();
		
		return has_item; 
	}

public:
	std::deque<T>			m_data; 
	SpinLock				m_lock; 
};

//====================================================================================
// Standalone C Functions
//====================================================================================


//====================================================================================
// Externs
//====================================================================================


//====================================================================================
// Written by Zachary Bracken : [7/11/2018]
//====================================================================================